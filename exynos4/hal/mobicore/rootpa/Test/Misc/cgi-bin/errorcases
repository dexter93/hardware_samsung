#!/usr/bin/perl


#
# for this to work, perl module needs to be installed.
# in ubuntu run
#
# sudo apt-get install libapache2-mod-perl2
# sudo apache2ctl restart 
# sudo  a2enmod perl
# These scripts print to  /var/log/apache2/error.log

package ReceiveCommandExpectingErrors;
use strict;

use Apache2::RequestIO (); 
use Apache2::RequestUtil (); 
use Apache2::RequestRec (); 
use Apache2::Log (); 

use Apache2::Const -compile => qw(OK DECLINED :log); 

#
# 10 unknown id
# 11 too long message
# BEGIN_ROOT_AUTHENTICATION(1): AQAAAJQBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAO3eAAA=
# 12 too short message
# AUTHENTICATE(0): AAAAAA==
# 13-14  preparation
# BEGIN_SP_AUTHENTICATION(3): AwAAABAAAAAAAAAACAAAAA==
# AUTHENTICATE(0): AAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyA=
# 15 no SP container
# TLT_CONT_LOCK_BY_SP(21): FQAAAEAAAAAAAAAACAAAAAEBAQEJCQkJAQEBAQkJCQkBAgMEBQYHCAkKCwwNDg8QERITFBUWFxgZGhscHR4fIA==
# 16 terminate
# AUTHENTICATE_TERMINATE(28): HAAAACwAAAAAAAAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyA=
# 17 can not store
# GENERATE_AUTH_TOKEN(4): BAAAAAAAAABEVWZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
# 18 response id wrong
# GENERATE_AUTH_TOKEN(4): BAAAAAAAAAAEVWZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
# 19 offset plus length out
# GENERATE_AUTH_TOKEN(4): BAAAAAAAAAAEBWZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
# 10 offset out
# GENERATE_AUTH_TOKEN(4): BAAAAAAAAAAEBQZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
#
# 21 unparseable base64, ignore error = false
# 22 unparseable base64
#
# ====================== expected result ====================== 
#
# <commandResultList>
#      <commandResult id="10">
#         <resultError errorCode="COMMAND_NOT_SUPPORTED_ERROR"/>
#     </commandResult>
#     <commandResult id="11">
#         <resultValue>AQAAgAAAAAAAAAAAAAAAAAAAAABEVWZ3iJmqu8zd7v8DAwMDAwMDAwkJCQkJCQkJCgoKCgoKCgoKCgoKCgoKCgoKCgoLCwsL</resultValue>
#     </commandResult>
#     <commandResult id="12">
#         <resultValue>AAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</resultValue>
#     </commandResult>
#     <commandResult id="13">
#         <resultValue>AwAAgAAAAAAAAAAAAAAAAAAAAABEVWZ3iJmqu8zd7v8IAAAAAwMDAwMDAwMSEhISEhISEhISEhITExMTExMTExMTExMTExMTExMTEw==</resultValue>
#     </commandResult>
#     <commandResult id="14">
#         <resultValue>AAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8g</resultValue>
#     </commandResult>
#     <commandResult id="15">
#         <resultError errorCode="REGISTRY_OBJECT_NOT_AVAILABLE" errorDetail="16"/>
#     </commandResult>
#     <commandResult id="16">
#         <resultValue>HAAAgAAAAAAAAAAAAAAAAAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8g</resultValue>
#     </commandResult>
#     <commandResult id="17">
#         <resultError errorCode="REGISTRY_ERROR" errorDetail="17"/>
#     </commandResult>
#     <commandResult id="18">
#         <resultError errorCode="INTERNAL_ERROR"/>  #### or COMMAND_EXECUTION_ERROR if it gets included
#     </commandResult>
#     <commandResult id="19">
#         <resultError errorCode="INTERNAL_ERROR"/>
#     </commandResult>
#     <commandResult id="20">
#         <resultError errorCode="INTERNAL_ERROR" errorDetail="-1"/>
#     </commandResult>
#     <commandResult id="21">
#         <resultError errorCode="COMMAND_NOT_SUPPORTED_ERROR"/>
#     </commandResult>
# </commandResultList>
# </ContentManagementResponse>\n'
#

sub handler { 
    my $r = shift; 

    # handle POST requests 
    if ( $r->method() eq "POST" ) { 

        # create a post data buffer 
        my $PostBuffer = ''; 

        # loop over each line of data 
        $r->log->notice("RootPATest.errorcases: Post Command Received. Data:"); 
        while($r->read($PostBuffer, 1024)) { 
            $r->log->notice("'$PostBuffer'"); 
        } 

	    $r->content_type('text/plain');
	    
	    print "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?> 
	    <ContentManagementRequest xmlns=\"http://www.mcore.gi-de.com/2012/04/schema/EnrollmentService\">
		<commands>
		    <command id=\"10\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>zzzzzz==</commandValue>
		    </command>
            <command id=\"11\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>AQAAAJQBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAO3eAAA=</commandValue>
		    </command>
		    <command id=\"12\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>AAAAAA==</commandValue>
		    </command>
		    <command id=\"13\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>AwAAABAAAAAAAAAACAAAAA==</commandValue>
		    </command>
		    <command id=\"14\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>AAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyA=</commandValue>
		    </command>
		    <command id=\"15\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>FQAAAEAAAAAAAAAACAAAAAEBAQEJCQkJAQEBAQkJCQkBAgMEBQYHCAkKCwwNDg8QERITFBUWFxgZGhscHR4fIA==</commandValue>
		    </command>
		    <command id=\"16\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>HAAAACwAAAAAAAAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyA=</commandValue>
		    </command>
		    <command id=\"17\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>BAAAAAAAAABEVWZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</commandValue>
		    </command>
		    <command id=\"18\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>BAAAAAAAAAAEVWZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</commandValue>
		    </command>
		    <command id=\"19\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>BAAAAAAAAAAEBWZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</commandValue>
		    </command>
		    <command id=\"20\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>BAAAAAAAAAAEBQZ3iJmquwEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</commandValue>
		    </command>
		    <command id=\"21\" type=\"CMP\" ignoreError=\"false\">
		        <commandValue>dasd5fg54bvfgty56000cs?4fds45ggytr??=DFGGDFGSDGGDSGS</commandValue>
		    </command>
		    <command id=\"22\" type=\"CMP\" ignoreError=\"true\">
		        <commandValue>dasd5fg54bvfgty56000cs?4fds45ggytr??=DFGGDFGSDGGDSGS</commandValue>
		    </command>
        </commands>
	    </ContentManagementRequest>";
    }  else {
        $r->log->notice("RootPATest.errorcases: HTTP command was not POST");
            $r->log->notice("RootPATest.errorcases: but $r->method()"); 
    }
    
    return Apache2::Const::OK;
} 

1;




